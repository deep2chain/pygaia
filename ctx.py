# -*- coding: utf-8 -*-
# written by junying, 2020-06-16
# developed for airdrop te
import hashlib
import coincurve
import base64
import requests
from tx import ecsign,accountinfo

def broadcast(fromaddr, toaddr, namount, gasprice, gaswanted, b64PubKey, b64Data, data="",restapi='47.98.194.7:1317'):
    
    strBroadcast = """{
        "type": "auth/StdTx",
        "value":{
            "msg": [{
                "type": "htdfservice/send",  
                "value":{
                    "From": "%s",
                    "To": "%s",
                    "Amount": [{
                        "denom": "satoshi",
                        "amount": "%d"
                    }],
                    "Data": "%s",
                    "GasPrice": "%d",
                    "GasWanted": "%d"
                }
            }],
            "fee": {
                "gas_wanted": "%d",
                "gas_price": "%d"
            },
            "signatures": [{
                "pub_key": {
                    "type": "tendermint/PubKeySecp256k1",
                    "value": "%s"
                },
                "signature": "%s"
            }],
            "memo": ""
        }
    }""" %(fromaddr, toaddr , namount, data, gasprice, gaswanted, gaswanted, gasprice, b64PubKey, b64Data)

    #去掉多余的空白字符
    strBroadcast = strBroadcast.replace(' ', '').replace('\t', '').replace('\n', '')
    bcastData = strBroadcast.encode('hex')
    print('\n--------------------------------------\n')
    print("广播的数据:"+ bcastData)
    print('\n--------------------------------------\n')

    # ---------------------------- 步骤3: 调用节点rpc接口,广播交易-----------------------------------

    #调用节点的rpc接口进行广播
    import json
    bcastData = {'tx' :  bcastData }   #rpc参数
    postData = json.dumps(bcastData)
    rsp = requests.post('http://%s/hs/broadcast'%restapi,  postData)


    #处理rpc接口
    try:
        if rsp.status_code == 200:
            rspJson = rsp.json()
            txid = str(rspJson['txhash'])
            print("%s 转给 %s 金额: %d  的交易广播成功, txid:%s" % (fromaddr, toaddr , namount, txid))
            
            from tools import write_log
            write_log("toAddr=%s|satoshiAmount=%d|txid=%s" % (toaddr, namount, txid))
        else:
            #注意, 如果报 Timed out waiting for tx to be included in a block  的错, 说明已经广播成功,只是为被打包
            if 'Timed' in rsp.text: print("已经广播成功, 但是为获取到txid, 此交易稍后会被节点"); return
            if 'already' in rsp.text: print("交易已经存在"); return
            print("广播失败: %s " % str(rsp.text)); return
    except Exception as e:
        print(e)
        return

def sign(hrp,fromprivkey, toaddr, namount,nsequence, naccnumber,chainid='testchain',gasprice=100,gaswanted=20000,data=""):
    from key import privkey2addr
    frompubkey,fromaddr = privkey2addr(fromprivkey,hrp)
    
    #使用字符拼装即可, 因为和字段的顺序有关, 不要使用json对象
    jUnTxStr = """{\
    "account_number": "%d",\
	"chain_id": "%s",\
	"fee": {\
        "gas_price": "%d",\
		"gas_wanted": "%d"\
	},\
    "memo": "",\
	"msgs": [{\
		"Amount": [{\
			"amount": "%d",\
            "denom": "satoshi"\
		}],\
        "Data": "%s",\
        "From": "%s",\
        "GasPrice": %s,\
        "GasWanted": %s,\
		"To": "%s"\
	}],\
    "sequence": "%d"\
    }"""  % (naccnumber, chainid, gasprice, gaswanted, namount, data, fromaddr,gasprice,gaswanted, toaddr , nsequence)

    print('\n--------------------------------------\n')
    #去掉多余的空格, 制表符, 换行符
    jUnTxStr = jUnTxStr.replace(' ', '').replace('\t', '').replace('\n', '')
    print(jUnTxStr)
    print('\n--------------------------------------\n')

    #被签名的数据
    print('\n--------------------------------------\n')
    print("json字符转为byteArray: ")
    for  i in bytearray(jUnTxStr):
        print('{0}({1}),'.format(i, chr(i))),
    print('\n--------------------------------------\n')

    #sha256
    print('\n-----------------------------------\n')
    shaData =  hashlib.sha256( bytearray(jUnTxStr) ).digest()
    print("Json的sha256结果:")
    print(shaData.encode('hex'))
    print('\n--------------------------------------\n')

    #获取私钥
    print('\n--------------------------------------\n')
    privkey = fromprivkey.decode('hex')
    print("strPrivKey: %s" % privkey.encode('hex'))
    print('\n--------------------------------------\n')

    #ECC签名
    print('\n--------------------------------------\n')
    r, s = ecsign(shaData,  privkey)  #只需要 r,s  不需要 v
    print('r:' + r.encode('hex'))
    print('s:' + s.encode('hex'))
    print('\n--------------------------------------\n')

    #拼装 r, s  , 并进行 base64编码     注意  ECC不需要
    print('\n--------------------------------------\n')
    b64data = base64.b64encode(r + s)
    print("base64编码后的签名信息: %s" % b64data)
    print('\n--------------------------------------\n')

    print('\n--------------------------------------\n')
    pubkey = frompubkey
    b64pubkey = base64.b64encode(pubkey.decode('hex'))
    print("base64编码后的公钥:" + b64pubkey)
    print('\n--------------------------------------\n')
    
    return b64pubkey, b64data

# smart contract manual execution test
def execute(hrp,contractaddr,fromprivkey, chainid='testchain',gasprice=100, gaswanted=15000000,restapi='127.0.0.1:1317'):
    import time
    start = time.time()
    from key import privkey2addr
    _,fromaddr = privkey2addr(fromprivkey,hrp=hrp)
    #------------------------------步骤1 : 获取地址信息拼装要签名的数据-----------------------------------
    print restapi
    rsp = accountinfo(fromaddr,restapi)
    print rsp
    naccnumber, nsequence = rsp["accountnumber"],rsp["sequence"]
    nbalance = rsp["balance"] * (10**8) - gaswanted*gasprice # transfer all balance if namount < 0
    if nbalance < 0: print('no balance'); return
    if naccnumber < 0 or nsequence < 0: return
    print('account_number : %d' % naccnumber)
    print('sequence: %d' % nsequence)
    #-------------------------- 步骤2: 签名 -----------------------------------------
    data='7da5efc80000000000000000000000004fabb8cc1740cd9849371f2a574ae4e4a502a59e0000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000198000000000000000000000000000000000000000000000000000000000000000c8000000000000000000000000fd1cee73f8e6278fd666000355d3cecef343e98f0000000000000000000000000f18abe7db55cd6b2c4f20f3041d4c61dfd5d09300000000000000000000000064af233ff8f16b1ddd2d11cf331ffabb2b285bd1000000000000000000000000ee728ffa20aedd7e09d25f76ed55b4eaa9a96c7500000000000000000000000005efe5e0676c8c29bda5411d452603638372b8e7000000000000000000000000b9e959f25c981df00c326250059137be4317ef67000000000000000000000000a0a1e1026fe916e3e50682e830dc2a6544a7d2f900000000000000000000000053ff10dee1c8f561e101866c57eed5cfc607c3ca0000000000000000000000001d1fe84d56d35e53d42a45c23f1c2151d86865e2000000000000000000000000233ea420044677943c6d35c2ea2ea732a4eeac14000000000000000000000000f63787f357a2cea59a6d65fe26527a45a27675a8000000000000000000000000e77237b7e20e94dac5a180bf1dea17417d8b9d72000000000000000000000000a0c465359d404bc43dbf1f311eeab613066a6b2300000000000000000000000018bb3fbad81692823d979fe05b6989f11525529200000000000000000000000084d3b0b138c821959e0b7629d0fcaecf314b686300000000000000000000000057d5e6deca8cc48873455b8f6653a169ff58b5c50000000000000000000000005a3629d04c74de4055ae44172cefbc885c224b0600000000000000000000000029e243b1da3f66b55d151b0f5966270b1f2baef90000000000000000000000006c043297567d46c568fd8ccdb22d8eb610a98a9200000000000000000000000010cb7fcb846f7cc0f6b5a8cac315b885812b3ed0000000000000000000000000836e50f7d60d41c3b3c987a4a23faa64cfe3ca8a000000000000000000000000a583435b444ceba1b9003bdc0dd3cf5527c9f1110000000000000000000000003c8bea5174ed7ac6a44e64a604035a8798a1185e000000000000000000000000fe2726d529bd673d0f151f9faa8162ad0b947cbd000000000000000000000000a223434e30c609a5e33cbc1dc54178160352c5f8000000000000000000000000ec7721d6c33c7a0522fd69b4a579c0bf60631fa1000000000000000000000000ecbf5b236d95e9db5016882d502aea95f92818fa000000000000000000000000f69a562600c67837e0315528c1fe3a067e33aca50000000000000000000000006c8a7cc69ba4532381c8534862d91670efaed9700000000000000000000000006f6e2d1bd825fb86f5de03e7aa289dbe9500adae0000000000000000000000009048d762cf531016dcaebcc05cf73699810ef20000000000000000000000000099d23ecf08a6fc7ffdfa2dea6686c098f07914c0000000000000000000000000ca2ab87570929818dde5a63d80025e47c88ae2fd00000000000000000000000013f6709b00164ae9da4ed851adfbaa0ddf432da7000000000000000000000000aedc4d0b8b6b17dc3b269c53a7090873f73a5d710000000000000000000000009aee91f4dcf2461e6df0850b977b46f7aab38b60000000000000000000000000fc5232b1d39eca593650120463e7db02c310c97b0000000000000000000000003b20199f8dbe6f42863d6612eb4811fadfce20bf000000000000000000000000dc2a8b82e0e4585db81db146d9a2363e4dbb5dc2000000000000000000000000918dd4554a5032f2cb45e80635dd5812aaea2844000000000000000000000000b8bffdf386d96e860857cfb989a5f30c2b338f7500000000000000000000000078f3b778df809d440b9e1c1fb8b67ab08069785a000000000000000000000000da1cdda6c07b1bc0e3fe4b212a5292a043107195000000000000000000000000293e914408656a1a87e0d055590c8da011182d60000000000000000000000000f8b4ec7d17b9fb7fff687f990472f8d19145987f000000000000000000000000fce70389c71c6f22489edfc03a5d54be1fd89368000000000000000000000000205ac59f07f38e758f5c29d36226b1660b16520b000000000000000000000000100598258e11e2b5d63b395ffcab2bd2965ddb3200000000000000000000000053e0bed7e7166fd4ccfc15e365412532950c41210000000000000000000000001adec679c1ac8c534d75515076604cc855e2cb1a000000000000000000000000f9b185df2dacade8816386345f6af6bb0004b52e000000000000000000000000b94aa75a800b0aa14bf4cb707bb3b65581b5e56d00000000000000000000000062005940b5ee531b3e5bb559e70977d61c949a3e0000000000000000000000009cd464faea7ca639a930112901d101f795bea2130000000000000000000000007aeae83c3b43729d9808dbe83ba1fd0478dc8ed0000000000000000000000000ec0821e8a50e0ec84ceac5d2cbf1a21942571d0d000000000000000000000000c26e4889e023f7d25fa35b5e834970a6cd23104b0000000000000000000000006de493118b9fe9b9ad4a474b060797bfd347602a000000000000000000000000816aeeae5099fac57efbfd8baff25dfc1c8b35bb000000000000000000000000c01ef62566d4f51bbf1a7cb77263b2199733273100000000000000000000000070177042b9944f0f9915b22583dac310e977eb8f00000000000000000000000050ba44381b42dd01a4d828fb097e22705ab2b3c9000000000000000000000000bf29a2650f96f4435a72f99e6071a36c8103664200000000000000000000000063a3be49749662fbe71a906ed5f40f7af1ca56ad000000000000000000000000ad7e218527481f22438101106a5282b2719d721b00000000000000000000000015a3833dabdd169b3b5b07b1d06fb70e7e199df90000000000000000000000003c18ca7f72728245ce16c8b6f38ee5674b16fefe000000000000000000000000bcdee9df1e211e5415c14d013c28a2a485e9a085000000000000000000000000031b69163dccd9203699c8a6282d905052789db4000000000000000000000000eb4e0c9fb80514027594e6edf991ccba409b92fc00000000000000000000000001d7496f1fbc2486616c0c9cf4bebf1576239e5400000000000000000000000037ca0bf55187d24f226414d359195f254cf96a26000000000000000000000000e72802604a88d6e4e7843a20aa504a5fa9b058fb0000000000000000000000003812b3ecbb6be1792678d0f2e2096ece41c67b920000000000000000000000008f4aefaf4fc094b7b80e996a600c5024e0b809f9000000000000000000000000ffeeca2df74415d5acae62ac2efa4d881a271a7d000000000000000000000000c67a3211fc0044a3c7ea3d1dc8905b1aa88a7d9200000000000000000000000016ac8b7203ab0f4d4dfbf648bc0b9f4fc9c5fc88000000000000000000000000ea306aa26ff510f8069ed4046998c52daa7fd87500000000000000000000000069e2d567e3d1e50d7328dd4fe2b24c4b88fbfac60000000000000000000000001b9f42e85784822258465b213b73e9a176e39fe3000000000000000000000000fb1b7478e4b8a179df568cecebd7ca64d48177da000000000000000000000000d76c405d695f3b79dc1ea492f507c8db2bf002c50000000000000000000000001beedbd4c98cdce6da918bb662707db5370199d700000000000000000000000016d122d9fad91bb9c8a1f1046e8d80712df762080000000000000000000000004485f390fe18dab1cec64b58b210a20a644b400e000000000000000000000000c27ff7c54c9f9ae1b066395df181cf3f69e851e00000000000000000000000009cf27839e488cfd180605d599cd6e16f384defa7000000000000000000000000137a9d994b139469387e912083082b29a0cfaa1b000000000000000000000000b99c93500614966e091e151d1a89eebb53d138e60000000000000000000000002e88902c90e843f2cd379273266205cfa14db979000000000000000000000000e17c1a0f9ec8b8f659381b132f633b490f4ea38000000000000000000000000097fe066db3bc5b3d83a5e17c632b20457f90f533000000000000000000000000bbce1c9f44cbc7db866d5e122c37fcb14f74c5f9000000000000000000000000c1c4b35880a77904e52be8df736a61e00d51c8b500000000000000000000000003db0c40116370314c82c07992e3152e76383117000000000000000000000000fad527bdbfe3c558256f3426875718fa7b620dd600000000000000000000000081e4d2850496d6e2b6914f5c09cca27b33bb81bd0000000000000000000000002f9b58bccc74b03f963dd06cb7d3f173c2a5cac10000000000000000000000006f68262feff384ad2ff4f9adc18b570a6c568cf4000000000000000000000000ce7f8ba2c9e838be88e285830c892c25d0fff12d000000000000000000000000f0d55cf42826b3227c67d7895643617ce7dd1fa5000000000000000000000000c8e17a6f4fe044e1721a1a7ad44b52b2076b5420000000000000000000000000c0303c547d873b80de562b1f6d5d8bc678ca0be200000000000000000000000056ca77310992edffa0689ada7e1999167d100f78000000000000000000000000de4dc4fd3ef39c0fdfd2eff34c29f6023f65088a0000000000000000000000001b72b2ff6b57e1537ee2208f0877bcaa87aa37fe000000000000000000000000d0139e38cb852116414f2459943081b020eee96300000000000000000000000037a4ef3fafe6b8e5c8c9071549ce09effe58961b000000000000000000000000ef73a1cd23575815be16dd94efcae99752aa9633000000000000000000000000efb2019245a53501dea77fd64a02e557fe2c74d900000000000000000000000020da621929bcad5f9a6ad44c88264ace223ab23e00000000000000000000000005ab76ed23b89b4c0ba898197531b6cdd842216c00000000000000000000000011a34aa9b0b0115f4c933f2c7e1b6339203ad0430000000000000000000000000579663a1c8c856844632bc8d2b4559a2a9fffe0000000000000000000000000e436663d403590f79d7e911459a14290050ce865000000000000000000000000aeb73e7807483569f175b596ef89b2bad23be5c1000000000000000000000000f2a051b1705a8ce983c2e9ef973895c4142b9161000000000000000000000000f094cd0c9b49d6b14502bfbd932320767372772200000000000000000000000013864a65bd2ecd0d78228593fb55deed778729380000000000000000000000006338e511c65e8d4c96f6143b2aa19a277410969d000000000000000000000000d7ca0aa39941995049709dae6c311d42fae5b9860000000000000000000000006a2679a2c65508982fc51502d4a1846637dcc989000000000000000000000000d7e55840c00113d5da08ecb62b5e17dd645a228b0000000000000000000000006a0f9994e388ee90a7a1a353331218db1c7f01d1000000000000000000000000f31ccdbcce590d51cc97ce3bf180062c8bfdeffb0000000000000000000000008364ad85386f0b56aeed911d04130f86809f5f7c000000000000000000000000c42bc5a098550d87075e22878e1356a73e8ae0b40000000000000000000000005555720c6929815ad31d99e38e969dc4a3ea888d00000000000000000000000012710481df310105b69e0801c959e1ef06bd06ce00000000000000000000000032c73ab0bb3ca70bb71f41cd1cd6ca7794ae5ed10000000000000000000000009d6d7adf4880cd9399f1f1bee2e60184ee4c61e0000000000000000000000000a3975fc4e7bd059e0aa94819ebc4b97b6cf328390000000000000000000000001c7665759c202526108f099cc5efdbad57dfcf1900000000000000000000000087a71e6de885f6feb60033b484bfe68dc7377ad5000000000000000000000000c6158e91af07e3df685450ffff47a943810739d50000000000000000000000002f17796a46d1cf3a885a5d67995037b0603ff11400000000000000000000000009bb9b9410098345a842bfbd2adbda25ac81f3120000000000000000000000006cb46e63294d598fc6b5586171380f0a2756485b00000000000000000000000002a1bf6ecdff1629a7c393c0c00e15d458d711db000000000000000000000000e840ee9ebe5976f1945c494082d6446c04c1f73c00000000000000000000000050c97ccee522b51403b93aa132b65e89389c2235000000000000000000000000121160046a59b2b7cdd1007f143e67581701ded70000000000000000000000004881bc76ca740823287cbe5605f49b85ad3bbaaa00000000000000000000000099fcbc3a2091368d1150d41ccd88fdd62de5eded0000000000000000000000001f1f92861af02f30760011f29e51c69b5f37c28200000000000000000000000015f688a3098423cb11b3d956a2dbb472592a6a370000000000000000000000003a155a5e2402e2b540f81c00e18fe3b948289db50000000000000000000000006cc092c1070ab9a18660c5dfea8158fdc11939d600000000000000000000000052d785531af339aacfdf1b10152f2bb973a435c3000000000000000000000000e3c84808b17c6d84da0b7186cbf38fface07c3060000000000000000000000000b07109a62c2bb4c5a02851b653fc53081fdb36600000000000000000000000093232770fb255ef8097fd56a80750090697d7365000000000000000000000000a673e74a03111c3187909db4bcd2f4a75767de03000000000000000000000000b32ac478c9c0063a54fd51727c8212a43fed0b9800000000000000000000000044c39a872a53551d8752a196a4ac9dbf280517e20000000000000000000000006f3e1d05dc98c2d88144bd52e2669cb44bfe2ce4000000000000000000000000e8daa104c2b937b71335f82d418292078629fd630000000000000000000000001e0861de9110bc1ec7930872bb4235c85ad697290000000000000000000000000d125815b677ea36e3c4a5eddb38d8a04026439c0000000000000000000000009284d0c7e2cd68fd1a46df2f0dd1551c9b5ecfc1000000000000000000000000253bd5823a88a1f830f30c3e4c1cb759adbf6b79000000000000000000000000d700929f1748e9d0d314f82f37268660e26105e2000000000000000000000000cd5b98ddf71cb83d65c1159a6a2500a36842f39e0000000000000000000000002762a501b3fce5d3f5b6b12ac8038f8e61072ea60000000000000000000000005aef25ccf3b33a70d6d68fc74e9f1da1f55e58c2000000000000000000000000ac1387e40dbac6e33552ec687fa481284df5f940000000000000000000000000a654fa57db2ba92cd8a6d5c1009dccae1a32d834000000000000000000000000cf745208d57b079bd5b6d6e9c0234336988cc6c4000000000000000000000000ef7946af6ad625b40b970a5fe62c472fb843f1600000000000000000000000000792472dc98a80a521e994e40ce517bb4429d8ed000000000000000000000000bd59ef61842462baa51f432fb4ed46930ae7b474000000000000000000000000ed32945fd120275630b11310eaf80197fbdd002d000000000000000000000000d4b02b0d3fa6ae8bf44a615c6be2a1fc8361ebfd0000000000000000000000003ec309a3f2266b7adc6adee1eb6ebadf4c901520000000000000000000000000a493fd9f4e32908f9a7bd86eebe3c2bea4f04887000000000000000000000000d5beb93416cf80e0e00b5f9fae1f00d43ba12d07000000000000000000000000e05cb3d5c3ab9a3173c36d21aa30318377ac459f00000000000000000000000045c7a0b556a6bc472cfb4f137712a9a96d2e6630000000000000000000000000d5f5a32e6418a521198bbe6114656d28aeec95bf000000000000000000000000e49b3bae463b336b616960b8aa4d0962c900b871000000000000000000000000b4985087866c8ca98f13834bbe784fd972ec7b93000000000000000000000000f6c8b50c818223f01f7d41105d811dbfd7012abf00000000000000000000000099344eb98ca6b1c67ee5392c2f13e5ffb2786bbb00000000000000000000000076e76f544629b0d4dfc4213db5db8cbd457e84e700000000000000000000000024fdf64dbb250f26587cf209922ceca64a7d3a6700000000000000000000000052ab49afda6437f9b3356a5529062fe4fc0d40320000000000000000000000003c43ae03c324cc69e30a9598031edec5db19e762000000000000000000000000b0e9f832e2a4182e731d9c905c9a07c864f4ab79000000000000000000000000d619a4050887e280355d6f751c6e0c16e1f5ed4a0000000000000000000000002f40ec68b18b152979e021ed67b1e3fc0af223280000000000000000000000003e8b9124dcac67b36314a771dab34694d616a395000000000000000000000000664643d9aa7adcc72dfb57aa8ca7b5f08092ceba000000000000000000000000e8b9ee8b3aaa1ebccb04718275d4df298d2fdb7800000000000000000000000046886fb7475433e2f485024c4e03c9021a16c32200000000000000000000000029245ad4d9567b3536f7235277baaee75c62cb6d000000000000000000000000a9bc97802e7967669388f3e50a83285229d1d1790000000000000000000000007d343fbda3df4c8de67fbb714e5e9dca0c605393000000000000000000000000d4054b57be418e035166b89e86259c5d205675f30000000000000000000000008337d7d3ed695bdc54c877e8642b6840a3ed589d00000000000000000000000000000000000000000000000000000000000000c80000000000000000000000000000000000000000000000000000000000488cfa0000000000000000000000000000000000000000000000000000000000519de400000000000000000000000000000000000000000000000000000000006fee61000000000000000000000000000000000000000000000000000000000048f1b7000000000000000000000000000000000000000000000000000000000008caa0000000000000000000000000000000000000000000000000000000000039a06c00000000000000000000000000000000000000000000000000000000007cae770000000000000000000000000000000000000000000000000000000000605f3200000000000000000000000000000000000000000000000000000000004f4e0900000000000000000000000000000000000000000000000000000000000940cc00000000000000000000000000000000000000000000000000000000005cb15e0000000000000000000000000000000000000000000000000000000000049c11000000000000000000000000000000000000000000000000000000000047c1c500000000000000000000000000000000000000000000000000000000004ae25300000000000000000000000000000000000000000000000000000000000cf75d000000000000000000000000000000000000000000000000000000000015f5800000000000000000000000000000000000000000000000000000000000883e85000000000000000000000000000000000000000000000000000000000075e1190000000000000000000000000000000000000000000000000000000000966acd00000000000000000000000000000000000000000000000000000000007830f60000000000000000000000000000000000000000000000000000000000955da600000000000000000000000000000000000000000000000000000000003af43d000000000000000000000000000000000000000000000000000000000051c80b00000000000000000000000000000000000000000000000000000000004e58ad00000000000000000000000000000000000000000000000000000000000cb165000000000000000000000000000000000000000000000000000000000044564800000000000000000000000000000000000000000000000000000000008c385400000000000000000000000000000000000000000000000000000000007d82b500000000000000000000000000000000000000000000000000000000004fb336000000000000000000000000000000000000000000000000000000000085bff2000000000000000000000000000000000000000000000000000000000032c1a2000000000000000000000000000000000000000000000000000000000037ce4b000000000000000000000000000000000000000000000000000000000034e93a00000000000000000000000000000000000000000000000000000000001886d20000000000000000000000000000000000000000000000000000000000564e5500000000000000000000000000000000000000000000000000000000005248ca000000000000000000000000000000000000000000000000000000000092239e00000000000000000000000000000000000000000000000000000000001b7d2d00000000000000000000000000000000000000000000000000000000006a8772000000000000000000000000000000000000000000000000000000000004f85c000000000000000000000000000000000000000000000000000000000082fc520000000000000000000000000000000000000000000000000000000000254f5900000000000000000000000000000000000000000000000000000000005cc9ae00000000000000000000000000000000000000000000000000000000007b4a28000000000000000000000000000000000000000000000000000000000091a2ea000000000000000000000000000000000000000000000000000000000050e2da000000000000000000000000000000000000000000000000000000000080ee5d00000000000000000000000000000000000000000000000000000000001232760000000000000000000000000000000000000000000000000000000000506a42000000000000000000000000000000000000000000000000000000000004c65500000000000000000000000000000000000000000000000000000000002fb86e000000000000000000000000000000000000000000000000000000000034ec0d000000000000000000000000000000000000000000000000000000000059b1580000000000000000000000000000000000000000000000000000000000354b5400000000000000000000000000000000000000000000000000000000005fe4ec0000000000000000000000000000000000000000000000000000000000727ea400000000000000000000000000000000000000000000000000000000008e608300000000000000000000000000000000000000000000000000000000008f3d8900000000000000000000000000000000000000000000000000000000005da4980000000000000000000000000000000000000000000000000000000000051fa700000000000000000000000000000000000000000000000000000000000d11ad00000000000000000000000000000000000000000000000000000000002591300000000000000000000000000000000000000000000000000000000000495edf000000000000000000000000000000000000000000000000000000000076ec4a0000000000000000000000000000000000000000000000000000000000247196000000000000000000000000000000000000000000000000000000000086d18000000000000000000000000000000000000000000000000000000000003f796e0000000000000000000000000000000000000000000000000000000000725c4d00000000000000000000000000000000000000000000000000000000000daf5500000000000000000000000000000000000000000000000000000000001170190000000000000000000000000000000000000000000000000000000000805d35000000000000000000000000000000000000000000000000000000000045881000000000000000000000000000000000000000000000000000000000005bd42500000000000000000000000000000000000000000000000000000000007e030700000000000000000000000000000000000000000000000000000000006dbf2400000000000000000000000000000000000000000000000000000000008992f600000000000000000000000000000000000000000000000000000000006a0d1e00000000000000000000000000000000000000000000000000000000001d4db100000000000000000000000000000000000000000000000000000000007c995200000000000000000000000000000000000000000000000000000000009606fc00000000000000000000000000000000000000000000000000000000004b6d9b00000000000000000000000000000000000000000000000000000000006a648a000000000000000000000000000000000000000000000000000000000087465c0000000000000000000000000000000000000000000000000000000000494dd100000000000000000000000000000000000000000000000000000000001287b40000000000000000000000000000000000000000000000000000000000807826000000000000000000000000000000000000000000000000000000000006a12c00000000000000000000000000000000000000000000000000000000002ede3d00000000000000000000000000000000000000000000000000000000005a87b30000000000000000000000000000000000000000000000000000000000605baa00000000000000000000000000000000000000000000000000000000007b149200000000000000000000000000000000000000000000000000000000006d31a600000000000000000000000000000000000000000000000000000000003583dc00000000000000000000000000000000000000000000000000000000002a570c000000000000000000000000000000000000000000000000000000000087577a000000000000000000000000000000000000000000000000000000000001e37f00000000000000000000000000000000000000000000000000000000006da3ed000000000000000000000000000000000000000000000000000000000064ce5f000000000000000000000000000000000000000000000000000000000028a382000000000000000000000000000000000000000000000000000000000025f9600000000000000000000000000000000000000000000000000000000000634218000000000000000000000000000000000000000000000000000000000029eed10000000000000000000000000000000000000000000000000000000000231f86000000000000000000000000000000000000000000000000000000000060284f000000000000000000000000000000000000000000000000000000000007a1e400000000000000000000000000000000000000000000000000000000007b90a900000000000000000000000000000000000000000000000000000000004f940d000000000000000000000000000000000000000000000000000000000015a69b00000000000000000000000000000000000000000000000000000000008f8b5600000000000000000000000000000000000000000000000000000000008325ba00000000000000000000000000000000000000000000000000000000007f0826000000000000000000000000000000000000000000000000000000000089bf73000000000000000000000000000000000000000000000000000000000011010700000000000000000000000000000000000000000000000000000000005ddbcd00000000000000000000000000000000000000000000000000000000007b31cc00000000000000000000000000000000000000000000000000000000004a0f74000000000000000000000000000000000000000000000000000000000037876700000000000000000000000000000000000000000000000000000000004c4402000000000000000000000000000000000000000000000000000000000035d2a50000000000000000000000000000000000000000000000000000000000813bf60000000000000000000000000000000000000000000000000000000000625a5a00000000000000000000000000000000000000000000000000000000002cfaa30000000000000000000000000000000000000000000000000000000000558e4a00000000000000000000000000000000000000000000000000000000008f688c0000000000000000000000000000000000000000000000000000000000204e97000000000000000000000000000000000000000000000000000000000060487e00000000000000000000000000000000000000000000000000000000008732ed00000000000000000000000000000000000000000000000000000000001bbb0400000000000000000000000000000000000000000000000000000000003a83ac000000000000000000000000000000000000000000000000000000000039a14400000000000000000000000000000000000000000000000000000000005dbcba00000000000000000000000000000000000000000000000000000000003142fd00000000000000000000000000000000000000000000000000000000003d6d0400000000000000000000000000000000000000000000000000000000002bdcf300000000000000000000000000000000000000000000000000000000003d68b0000000000000000000000000000000000000000000000000000000000079beb800000000000000000000000000000000000000000000000000000000006254d3000000000000000000000000000000000000000000000000000000000074c465000000000000000000000000000000000000000000000000000000000041843500000000000000000000000000000000000000000000000000000000007146970000000000000000000000000000000000000000000000000000000000654d6f000000000000000000000000000000000000000000000000000000000089136d000000000000000000000000000000000000000000000000000000000071423d00000000000000000000000000000000000000000000000000000000004e98d100000000000000000000000000000000000000000000000000000000006bcea70000000000000000000000000000000000000000000000000000000000332aea000000000000000000000000000000000000000000000000000000000029700a00000000000000000000000000000000000000000000000000000000002d510400000000000000000000000000000000000000000000000000000000005f2562000000000000000000000000000000000000000000000000000000000072ca30000000000000000000000000000000000000000000000000000000000076a5e30000000000000000000000000000000000000000000000000000000000894359000000000000000000000000000000000000000000000000000000000097aa3100000000000000000000000000000000000000000000000000000000005d40050000000000000000000000000000000000000000000000000000000000063a5100000000000000000000000000000000000000000000000000000000009795c700000000000000000000000000000000000000000000000000000000008193e900000000000000000000000000000000000000000000000000000000002d7f56000000000000000000000000000000000000000000000000000000000009a6a300000000000000000000000000000000000000000000000000000000003c103000000000000000000000000000000000000000000000000000000000006979d000000000000000000000000000000000000000000000000000000000007bcff3000000000000000000000000000000000000000000000000000000000086e67b000000000000000000000000000000000000000000000000000000000095975500000000000000000000000000000000000000000000000000000000000e7d11000000000000000000000000000000000000000000000000000000000051aab1000000000000000000000000000000000000000000000000000000000090494d0000000000000000000000000000000000000000000000000000000000918ff90000000000000000000000000000000000000000000000000000000000544a32000000000000000000000000000000000000000000000000000000000085dea0000000000000000000000000000000000000000000000000000000000020581900000000000000000000000000000000000000000000000000000000005e2dcb000000000000000000000000000000000000000000000000000000000078753700000000000000000000000000000000000000000000000000000000008a84de000000000000000000000000000000000000000000000000000000000077593100000000000000000000000000000000000000000000000000000000008e4c7f000000000000000000000000000000000000000000000000000000000050ba9a00000000000000000000000000000000000000000000000000000000003bee710000000000000000000000000000000000000000000000000000000000920c4e000000000000000000000000000000000000000000000000000000000042f82e0000000000000000000000000000000000000000000000000000000000398e5a000000000000000000000000000000000000000000000000000000000055963a00000000000000000000000000000000000000000000000000000000007a4a5f000000000000000000000000000000000000000000000000000000000037d2b400000000000000000000000000000000000000000000000000000000006b9800000000000000000000000000000000000000000000000000000000000087bc1500000000000000000000000000000000000000000000000000000000008f0fa900000000000000000000000000000000000000000000000000000000006a6c8d000000000000000000000000000000000000000000000000000000000086a30d000000000000000000000000000000000000000000000000000000000035d83400000000000000000000000000000000000000000000000000000000008a32fd00000000000000000000000000000000000000000000000000000000007822ff000000000000000000000000000000000000000000000000000000000072cb3400000000000000000000000000000000000000000000000000000000002414d30000000000000000000000000000000000000000000000000000000000307246000000000000000000000000000000000000000000000000000000000035b4a5000000000000000000000000000000000000000000000000000000000010bbcd000000000000000000000000000000000000000000000000000000000026e5b30000000000000000000000000000000000000000000000000000000000575a380000000000000000000000000000000000000000000000000000000000852968'
    b64PubKey, b64Data = sign(hrp, fromprivkey, contractaddr, 0,nsequence, naccnumber,chainid,gasprice,gaswanted,data)
    broadcast(fromaddr,contractaddr,0,gasprice,gaswanted,b64PubKey,b64Data,data,restapi)

# usage: python ctx.py 
# block gas limit: 15,000,000
# tx gas limit: 75,00,000
if __name__ == "__main__":
    fromprivkey = 'c06d9c5b991122f7c51a2cb89fc8efbf3e47e746c980f5afdbf2ac45f88aaf3d'
    frompubkey = '036b7666151ff16dabab74c40c299824227b42b7ab9a8c31e134793330c2e27384'
    contractaddr='htdf1tdm4fyfc0z3ynl44kj8ykyjptx5h484r0q6gj7'
    restapi = '127.0.0.1:1317'
    chainid = 'testchain'
    gaswanted=7500000
    execute('htdf',contractaddr=contractaddr,fromprivkey=fromprivkey,gaswanted=gaswanted)
    